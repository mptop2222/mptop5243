 <!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¤šå±¤ä¸‹æ‹‰æŸ¥è©¢å­¸ç”Ÿ</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 30px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      background-attachment: fixed;
      color: #333;
    }
    
    h2 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.2em;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    
    h3 {
      color: #3498db;
      border-bottom: 2px solid #3498db;
      padding-bottom: 8px;
      margin-top: 0;
    }
    
    .container {
      background-color: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    select, input {
      padding: 10px 15px;
      width: 250px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    
    .search-container {
      margin-bottom: 30px;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    #result {
      margin-top: 30px;
      padding: 25px;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      background-color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }
    
    .student-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    
    .student-info p {
      margin: 8px 0;
      font-size: 16px;
    }
    
    .student-info strong {
      color: #2c3e50;
    }
    
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
      margin-left: 10px;
    }
    
    button:hover {
      background-color: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    hr {
      border: 0;
      height: 1px;
      background: linear-gradient(to right, transparent, #3498db, transparent);
      margin: 30px 0;
    }
    
    label {
      display: inline-block;
      width: 80px;
      font-weight: 500;
      margin-right: 10px;
    }
    
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .container {
        padding: 15px;
      }
      
      select, input {
        width: 100%;
        margin-bottom: 10px;
      }
      
      button {
        width: 100%;
        margin-left: 0;
        margin-top: 10px;
      }
      
      .student-info {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ“š å­¸ç”Ÿè³‡æ–™æŸ¥è©¢ç³»çµ±</h2>

    <div class="search-container">
      <h3>ğŸ” å¤šå±¤ä¸‹æ‹‰æŸ¥è©¢</h3>
      <label>å­¸åˆ¶ï¼š</label>
      <select id="typeSelect" onchange="filterGrade()">
        <option value="">--è«‹é¸æ“‡å­¸åˆ¶--</option>
        <option value="åœ‹ä¸­">åœ‹ä¸­</option>
        <option value="é«˜ä¸­">é«˜ä¸­</option>
      </select>
      <br><br>

      <label>å¹´ç´šï¼š</label>
      <select id="gradeSelect" onchange="filterClass()">
        <option value="">--è«‹é¸æ“‡å¹´ç´š--</option>
      </select>
      <br><br>

      <label>ç­ç´šï¼š</label>
      <select id="classSelect" onchange="filterNames()">
        <option value="">--è«‹é¸æ“‡ç­ç´š--</option>
      </select>
      <br><br>

      <label>å­¸ç”Ÿï¼š</label>
      <select id="nameSelect" onchange="showStudent()">
        <option value="">--è«‹é¸æ“‡å­¸ç”Ÿ--</option>
      </select>
    </div>

    <div class="search-container">
      <h3>ğŸ”¢ å­¸è™Ÿç›´æ¥æŸ¥è©¢</h3>
      <label>å­¸è™Ÿï¼š</label>
      <input type="text" id="studentIdInput" placeholder="è¼¸å…¥å­¸è™Ÿ">
      <button onclick="searchByStudentId()">æŸ¥è©¢</button>
    </div>

    <hr>
    <div id="result"></div>
  </div>

  <script type="module">
    // ä¿æŒåŸæœ‰çš„JavaScriptä»£ç¢¼ä¸è®Š
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAMlgRs8aO-eZSamx1-EF3y2obIAOLvaZI",
      authDomain: "nanshan-student.firebaseapp.com",
      projectId: "nanshan-student",
      storageBucket: "nanshan-student.firebasestorage.app",
      messagingSenderId: "879754099667",
      appId: "1:879754099667:web:0c0805c2d918b8b41e4d26",
      measurementId: "G-KTX7TH9ETW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let students = [];

    async function loadData() {
      try {
        const snapshot = await getDocs(collection(db, "å—å±±å­¸ç”Ÿè³‡æ–™"));
        students = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          data.id = doc.id;
          students.push(data);
        });
        console.log("å·²è¼‰å…¥å­¸ç”Ÿè³‡æ–™ï¼š", students.length);
      } catch (error) {
        console.error("è¼‰å…¥è³‡æ–™å¤±æ•—ï¼š", error);
        alert("ç„¡æ³•è¼‰å…¥å­¸ç”Ÿè³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦");
      }
    }

    function filterGrade() {
      const type = document.getElementById("typeSelect").value;
      const gradeSelect = document.getElementById("gradeSelect");
      gradeSelect.innerHTML = '<option value="">--è«‹é¸æ“‡å¹´ç´š--</option>';

      const grades = new Set(
        students.filter(s => s.å­¸åˆ¶ === type).map(s => s.å¹´ç´š)
      );

      [...grades].sort().forEach(g => {
        const opt = document.createElement("option");
        opt.value = g;
        opt.textContent = g;
        gradeSelect.appendChild(opt);
      });

      // é‡è¨­ä¸‹å±¤
      document.getElementById("classSelect").innerHTML = '<option value="">--è«‹é¸æ“‡ç­ç´š--</option>';
      document.getElementById("nameSelect").innerHTML = '<option value="">--è«‹é¸æ“‡å­¸ç”Ÿ--</option>';
      document.getElementById("result").innerHTML = '';
    }

    function filterClass() {
      const type = document.getElementById("typeSelect").value;
      const grade = document.getElementById("gradeSelect").value;
      const classSelect = document.getElementById("classSelect");
      classSelect.innerHTML = '<option value="">--è«‹é¸æ“‡ç­ç´š--</option>';

      const classes = new Set(
        students.filter(s => s.å­¸åˆ¶ === type && s.å¹´ç´š === grade).map(s => s.ç­ç´š)
      );

      [...classes].sort().forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        classSelect.appendChild(opt);
      });

      document.getElementById("nameSelect").innerHTML = '<option value="">--è«‹é¸æ“‡å­¸ç”Ÿ--</option>';
      document.getElementById("result").innerHTML = '';
    }

    function filterNames() {
      const type = document.getElementById("typeSelect").value;
      const grade = document.getElementById("gradeSelect").value;
      const cls = document.getElementById("classSelect").value;
      const nameSelect = document.getElementById("nameSelect");
      nameSelect.innerHTML = '<option value="">--è«‹é¸æ“‡å­¸ç”Ÿ--</option>';

      const names = students.filter(s =>
        s.å­¸åˆ¶ === type && s.å¹´ç´š === grade && s.ç­ç´š === cls
      );

      names.sort((a, b) => a.å§“å.localeCompare(b.å§“å)).forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.id;
        opt.textContent = `${s.å§“å} (${s.å­¸è™Ÿ || s.id})`;
        nameSelect.appendChild(opt);
      });
      
      document.getElementById("result").innerHTML = '';
    }

    function searchByStudentId() {
      const studentId = document.getElementById("studentIdInput").value.trim();
      if (!studentId) {
        alert("è«‹è¼¸å…¥å­¸è™Ÿ");
        return;
      }
      
      const student = students.find(s => 
        s.å­¸è™Ÿ === studentId || s.id === studentId
      );
      
      if (student) {
        showStudentDetails(student);
      } else {
        document.getElementById("result").innerHTML = `
          <h3>âŒ æŸ¥ç„¡çµæœ</h3>
          <p>æ‰¾ä¸åˆ°å­¸è™Ÿç‚º <strong>${studentId}</strong> çš„å­¸ç”Ÿ</p>
        `;
      }
    }

    function showStudent() {
      const id = document.getElementById("nameSelect").value;
      const student = students.find(s => s.id === id);
      if (student) {
        showStudentDetails(student);
      }
    }

    function showStudentDetails(student) {
      document.getElementById("result").innerHTML = `
        <h3>ğŸ“ å­¸ç”Ÿè©³ç´°è³‡æ–™</h3>
        <div class="student-info">
          <p><strong>å­¸è™Ÿï¼š</strong> ${student.å­¸è™Ÿ || student.id}</p>
          <p><strong>å§“åï¼š</strong> ${student.å§“å}</p>
          <p><strong>å­¸åˆ¶ï¼š</strong> ${student.å­¸åˆ¶}</p>
          <p><strong>å¹´ç´šï¼š</strong> ${student.å¹´ç´š}</p>
          <p><strong>ç­ç´šï¼š</strong> ${student.ç­ç´š}</p>
        </div>
      `;
    }

    // æ›è¼‰å‡½æ•¸åˆ°å…¨å±€
    window.filterGrade = filterGrade;
    window.filterClass = filterClass;
    window.filterNames = filterNames;
    window.showStudent = showStudent;
    window.searchByStudentId = searchByStudentId;

    window.onload = loadData;
  </script>
</body>
</html>